## Python 运算符

[TOC]

### Python算术运算符

以下假设变量 **a=10**，变量 **b=21**：

| 运算符 | 描述                                            | 实例                             |
| :----- | :---------------------------------------------- | :------------------------------- |
| +      | 加 - 两个对象相加                               | a + b 输出结果 31                |
| -      | 减 - 得到负数或是一个数减去另一个数             | a - b 输出结果 -11               |
| *      | 乘 - 两个数相乘或是返回一个被重复若干次的字符串 | a * b ==输出结果 210==           |
| /      | 除 - x 除以 y                                   | b / a ==输出结果 2.1==           |
| %      | 取模 - 返回除法的余数                           | b % a 输出结果 1                 |
| **     | 幂 - 返回x的y次幂                               | a**b 为10的21次方                |
| //     | ==取整除 - 向下取接近商的整数==                 | `>>> 9//2  4  ` ` >>> -9//2  -5` |

#### 序列相加相乘

```python
print((1, 2) + (3, 4))  # (1,2,3,4)
print((1, 2) * 3)  # (1,2,1,2,1,2)
print('abc' * 3)  # 'abcabcabc'
print(('abc') * 3)  # 'abcabcabc',单元素必须加逗号才是元组，否则就是单变量
print(('abc',) * 3)  # ('abc', 'abc', 'abc')
```



### Python比较运算符

以下假设变量a为10，变量b为20：

| 运算符 | 描述                                                         | 实例                  |
| :----- | :----------------------------------------------------------- | :-------------------- |
| ==     | 等于 - 比较对象是否相等                                      | (a == b) 返回 False。 |
| !=     | 不等于 - 比较两个对象是否不相等                              | (a != b) 返回 True。  |
| >      | 大于 - 返回x是否大于y                                        | (a > b) 返回 False。  |
| <      | 小于 - 返回x是否小于y。所有比较运算符返回1表示真，返回0表示假。这分别与特殊的变量True和False等价。注意，这些变量名的大写。 | (a < b) 返回 True。   |
| >=     | 大于等于 - 返回x是否大于等于y。                              | (a >= b) 返回 False。 |
| <=     | 小于等于 - 返回x是否小于等于y。                              | (a <= b) 返回 True。  |

#### 整型和bool可比较

整形和布尔形可以比较，==bool是Int的子类==

```python
1.2 > True  # True 
1 > True  # False 
```

#### 字符和字符比较

字符比较，按照字典序

```python
bool('0')  # True 
 
'ab'>'aa'  # True  # 字典序 
```

#### 整形和字符不可比较

Pass

#### 列表和列表比较

序列对象通常可以与相同序列类型的其他对象比较。这种比较==使用字典式顺序==

```python
print([1, 5] < [3, 4, 6])  # True
print([1, 4, [5, 6]] < [3, 4, 6])  # True
print([3, 4, [5, 6]] < [3, 4, 6])  # TypeError: '<' not supported between instances of 'list' and 'int'
```

#### 链式比较

优先级 比较 高于 等于

```python
4 > 3 == 3  # True 4>3 and 3==3
```

#### 类型比较

类型比较  isinstance(item, str)，不用  type(item) == str

#### if seq原理

```python

# if seq原理：
#	返回的是bool(seq)，会调用seq.__bool__(py2里是seq.__nonzero__)，
#   如果seq对应的类没有__bool__，则调用__len__，
#   如果也没有__len__且非None，会默认返回True。
```



### Python赋值运算符

以下假设变量a为10，变量b为20：

| 运算符 | 描述                                                         | 实例                                                         |
| :----- | :----------------------------------------------------------- | :----------------------------------------------------------- |
| =      | 简单的赋值运算符                                             | c = a + b 将 a + b 的运算结果赋值为 c                        |
| +=     | 加法赋值运算符                                               | c += a 等效于 c = c + a                                      |
| -=     | 减法赋值运算符                                               | c -= a 等效于 c = c - a                                      |
| *=     | 乘法赋值运算符                                               | c *= a 等效于 c = c * a                                      |
| /=     | 除法赋值运算符                                               | c /= a 等效于 c = c / a                                      |
| %=     | 取模赋值运算符                                               | c %= a 等效于 c = c % a                                      |
| **=    | 幂赋值运算符                                                 | c \**= a 等效于 c = c ** a                                   |
| //=    | 取整除赋值运算符                                             | c //= a 等效于 c = c // a                                    |
| :=     | ==海象运算符，可在表达式内部为变量赋值==。**Python3.8 版本新增运算符**。 | 在这个示例中，赋值表达式可以避免调用 len() 两次:<br/>`if (n := len(a)) > 10:    print(f"List is too long ({n} elements, expected <= 10)")` |



### Python位运算符

按位运算符是把数字看作二进制来进行计算的。Python中的按位运算法则如下：

下表中变量 a 为 60，b 为 13二进制格式如下：

```
a = 0011 1100

b = 0000 1101

-----------------

a&b = 0000 1100

a|b = 0011 1101

a^b = 0011 0001

~a  = 1100 0011
```

| 运算符 | 描述                                                         | 实例                                                         |
| :----- | :----------------------------------------------------------- | :----------------------------------------------------------- |
| &      | 按位与运算符：参与运算的两个值,如果两个相应位都为1,则该位的结果为1,否则为0 | (a & b) 输出结果 12 ，二进制解释： 0000 1100                 |
| \|     | 按位或运算符：只要对应的二个二进位有一个为1时，结果位就为1。 | (a \| b) 输出结果 61 ，二进制解释： 0011 1101                |
| ^      | ==按位异或运算符==：当两对应的二进位相异时，结果为1          | (a ^ b) 输出结果 49 ，二进制解释： 0011 0001                 |
| ~      | 按位取反运算符：对数据的每个二进制位取反,即把1变为0,把0变为1。==**~x** 类似于 **-x-1**== | (~a ) 输出结果 -61 ，二进制解释： 1100 0011， 在一个有符号二进制数的补码形式。 |
| <<     | 左移动运算符：运算数的各二进位全部左移若干位，由"<<"右边的数指定移动的位数，高位丢弃，低位补0。 | a << 2 输出结果 240 ，二进制解释： 1111 0000                 |
| >>     | 右移动运算符：把">>"左边的运算数的各二进位全部右移若干位，">>"右边的数指定移动的位数 | a >> 2 输出结果 15 ，二进制解释： 0000 1111                  |



### Python逻辑运算符

Python语言支持逻辑运算符，以下假设变量 a 为 10, b为 20:

| 运算符 | 逻辑表达式 | 描述                                                         | 实例                    |
| :----- | :--------- | :----------------------------------------------------------- | :---------------------- |
| and    | x and y    | 布尔"与" - 如果 x 为 False，x and y 返回 x 的值，否则返回 y 的计算值。 | (a and b) ==返回 20==。 |
| or     | x or y     | 布尔"或" - 如果 x 是 True，它返回 x 的值，否则它返回 y 的计算值。 | (a or b) ==返回 10==。  |
| not    | not x      | 布尔"非" - 如果 x 为 True，返回 False 。如果 x 为 False，它返回 True。 | not(a and b) 返回 False |

其实python中==and并不是直接返回True/False，而是返回比较的值==，具体如下逻辑：

and：停止的目标为False, 如果有True，一直往下找，直到返回最后一个或者第一个False

or: 停止的目标为True，如果有False，一直往下找，直到返回最后一个或者第一个True

**实例：**

```python
a = {1, 2, 3, 0, 1} and {4, 5, 6, 1, 0}
b = {1, 2, 3} or {4, 5, 6}
print(a)  # {0, 1, 4, 5, 6}
print(b)  # {1, 2, 3}

print(2 and 1)  # 1
print(1 and 2)  # 2
print(0 and 1)  # 0
print(-1 and 1)  # 1
```



### Python成员运算符

除了以上的一些运算符之外，Python还支持成员运算符，测试实例中包含了一系列的成员，包括字符串，列表或元组。

| 运算符 | 描述                                                    | 实例                                              |
| :----- | :------------------------------------------------------ | :------------------------------------------------ |
| in     | 如果在指定的序列中找到值返回 True，否则返回 False。     | x 在 y 序列中 , 如果 x 在 y 序列中返回 True。     |
| not in | 如果在指定的序列中没有找到值返回 True，否则返回 False。 | x 不在 y 序列中 , 如果 x 不在 y 序列中返回 True。 |



### Python身份运算符

身份运算符用于比较两个对象的存储单元

| 运算符 | 描述                                        | 实例                                                         |
| :----- | :------------------------------------------ | :----------------------------------------------------------- |
| is     | ==is 是判断两个标识符是不是引用自一个对象== | **x is y**, 类似 **id(x) == id(y)** , 如果引用的是同一个对象则返回 True，否则返回 False |
| is not | is not 是判断两个标识符是不是引用自不同对象 | **x is not y** ， 类似 **id(x) != id(y)**。如果引用的不是同一个对象则返回结果 True，否则返回 False。 |

**注：** ==[id()](https://www.runoob.com/python/python-func-id.html) 函数用于获取对象内存地址==

以下实例演示了Python所有身份运算符的操作：

```python
#!/usr/bin/python3
 
a = 20
b = 20
 
if ( a is b ):
   print ("1 - a 和 b 有相同的标识")
else:
   print ("1 - a 和 b 没有相同的标识")
 
if ( id(a) == id(b) ):
   print ("2 - a 和 b 有相同的标识")
else:
   print ("2 - a 和 b 没有相同的标识")
 
# 修改变量 b 的值
b = 30
if ( a is b ):
   print ("3 - a 和 b 有相同的标识")
else:
   print ("3 - a 和 b 没有相同的标识")
 
if ( a is not b ):
   print ("4 - a 和 b 没有相同的标识")
else:
   print ("4 - a 和 b 有相同的标识")
```

以上实例输出结果：

```
1 - a 和 b 有相同的标识
2 - a 和 b 有相同的标识
3 - a 和 b 没有相同的标识
4 - a 和 b 没有相同的标识
```

> is 与 == 区别：
>
> ==is 用于判断两个变量引用对象是否为同一个， == 用于判断引用变量的值是否相等==。

```python
>>>a = [1, 2, 3] 

>>> b = a  
>>> b == a 
True 

>>> b = a[:] 
>>> b is a 
False 

>>> b == a 
True
```



### Python运算符优先级

以下表格列出了从最高到最低优先级的所有运算符：

| 运算符                   | 描述                                                       |
| :----------------------- | :--------------------------------------------------------- |
| **                       | 指数 (最高优先级)                                          |
| ~ + -                    | ==按位翻转==, 一元加号和减号 (最后两个的方法名为 +@ 和 -@) |
| * / % //                 | 乘，除，求余数和取整除                                     |
| + -                      | 加法减法                                                   |
| >> <<                    | 右移，左移运算符                                           |
| &                        | 位 'AND'                                                   |
| ^ \|                     | 位运算符                                                   |
| <= < > >=                | 比较运算符                                                 |
| == !=                    | 等于运算符                                                 |
| = %= /= //= -= += *= **= | 赋值运算符                                                 |
| is is not                | 身份运算符                                                 |
| in not in                | 成员运算符                                                 |
| not and or               | 逻辑运算符                                                 |



> 注意：
>
> ==Pyhton3 已不支持 <> 运算符，可以使用 != 代替==，如果你一定要使用这种比较运算符，可以使用以下的方式：
>
> ```
> >>> from __future__ import barry_as_FLUFL
> >>> 1 <> 2
> True
> ```



### numpy @运算符

在 Python 3.5 中，矩阵乘法函数 [numpy.matmul](https://docs.scipy.org/doc/numpy-1.13.0/reference/generated/numpy.matmul.html) 遵循 [PEP465](https://www.python.org/dev/peps/pep-0465/)，引入了 @ 运算符。

**规范**

| 运算符 | 优先级 / 结合性 | 方法                        |
| ------ | --------------- | --------------------------- |
| @      | 与 * 相同       | `__matmul__`, `__rmatmul__` |
| @=     | N/A             | `__imatmul__`               |

首先先给一个比较简单的用法解释：
`*`：        根据数据类型的不同，可能是做**点乘**运算，也可能做**矩阵乘法**运算
`@`：        ==只做**矩阵乘法**运算==
`.dot`：     只做**矩阵乘法**运算
`np.mutiply`：只做**点乘**运算

**用例**

- a, b 均为 2*2 的列表时：

  ```python
  >>> a = [[1, 0], [0, 1]]
  >>> b = [[4, 1], [2, 2]]
  # Using dot function:
  >>> np.dot(a, b)
  array([[4, 1],
         [2, 2]])
  # Using dot method:
  >>> a.dot(b)
  AttributeError: 'list' object has no attribute 'dot'
  # Using @ operator:
  >>> a @ b
  TypeError: unsupported operand type(s) for @: 'list' and 'list'
  ```

- a, b 均为二维矩阵时：

  ```python
  a = np.array([[1, 0], [0, 1]])
  b = np.array([[4, 1], [2, 2]])
  # Using dot function:
  >>> np.dot(a, b)
  array([[4, 1],
         [2, 2]])
  # Using dot method:
  >>> a.dot(b)
  array([[4, 1],
         [2, 2]])
  # Using @ operator:
  >>> a @ b
  array([[4, 1],
         [2, 2]])
  ```